'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _lodash = require('lodash');

var _loaderUtils = require('loader-utils');

var _loaderUtils2 = _interopRequireDefault(_loaderUtils);

var _interpolateNamespaces = require('./interpolateNamespaces');

var _interpolateNamespaces2 = _interopRequireDefault(_interpolateNamespaces);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @private
 * @type {RegExp}
 */
var MODULE_EXPORTS = /module\.exports\s?=\s?({[\s\S\n\t]+?});?/;

/**
 * @param {*} loaderContext
 * @param {String} content
 * @param {Object} options
 * @returns {Object}
 */

exports.default = function (loaderContext, content, options) {
    var translations = void 0;

    if (Array.isArray(loaderContext.inputValue)) {
        translations = loaderContext.inputValue[0];
    } else if ((0, _lodash.isString)(loaderContext.value)) {
        translations = JSON.parse(loaderContext.value);
    } else if (MODULE_EXPORTS.test(content)) {
        var match = content.match(MODULE_EXPORTS),
            value = match.length >= 1 ? match[1].toString() : '{}';

        translations = JSON.parse(_loaderUtils2.default.parseString(value));
    } else {
        translations = content;
    }

    if (!(0, _lodash.isObject)(translations)) {
        translations = {};
    }

    var namespaces = (0, _interpolateNamespaces2.default)(loaderContext, translations, options);

    return (0, _lodash.mapKeys)(translations, function (value, key) {
        return namespaces + key;
    });
};

module.exports = exports['default'];
//# sourceMappingURL=extractTranslations.js.map